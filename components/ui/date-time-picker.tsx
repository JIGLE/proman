"use client";\n\nimport * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"./button\";\nimport { Input } from \"./input\";\nimport { CalendarDays, ChevronLeft, ChevronRight, Calendar } from \"lucide-react\";\n\n// Date picker component with better UX\nexport interface DatePickerProps {\n  value?: Date;\n  onChange?: (date: Date | undefined) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  minDate?: Date;\n  maxDate?: Date;\n  className?: string;\n  label?: string;\n  error?: string;\n  required?: boolean;\n  format?: \"short\" | \"long\" | \"numeric\";\n}\n\nconst MONTHS = [\n  'January', 'February', 'March', 'April', 'May', 'June',\n  'July', 'August', 'September', 'October', 'November', 'December'\n];\n\nconst WEEKDAYS = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'];\n\nexport function DatePicker({\n  value,\n  onChange,\n  placeholder = \"Select date...\",\n  disabled,\n  minDate,\n  maxDate,\n  className,\n  label,\n  error,\n  required,\n  format = \"short\"\n}: DatePickerProps) {\n  const [isOpen, setIsOpen] = React.useState(false);\n  const [viewDate, setViewDate] = React.useState(value || new Date());\n  const [inputValue, setInputValue] = React.useState(\n    value ? formatDate(value, format) : ''\n  );\n  \n  const dropdownRef = React.useRef<HTMLDivElement>(null);\n  const triggerRef = React.useRef<HTMLDivElement>(null);\n\n  // Close on click outside\n  React.useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (\n        dropdownRef.current &&\n        !dropdownRef.current.contains(event.target as Node) &&\n        triggerRef.current &&\n        !triggerRef.current.contains(event.target as Node)\n      ) {\n        setIsOpen(false);\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // Update input when value changes\n  React.useEffect(() => {\n    setInputValue(value ? formatDate(value, format) : '');\n  }, [value, format]);\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n    setInputValue(newValue);\n    \n    // Try to parse the date\n    const parsedDate = parseDate(newValue);\n    if (parsedDate && isValidDate(parsedDate, minDate, maxDate)) {\n      onChange?.(parsedDate);\n      setViewDate(parsedDate);\n    }\n  };\n\n  const handleDateSelect = (date: Date) => {\n    if (!isValidDate(date, minDate, maxDate)) return;\n    \n    onChange?.(date);\n    setInputValue(formatDate(date, format));\n    setIsOpen(false);\n  };\n\n  const handleClear = () => {\n    onChange?.(undefined);\n    setInputValue('');\n  };\n\n  const navigateMonth = (direction: 'prev' | 'next') => {\n    setViewDate(prev => {\n      const newDate = new Date(prev);\n      newDate.setMonth(prev.getMonth() + (direction === 'next' ? 1 : -1));\n      return newDate;\n    });\n  };\n\n  const navigateYear = (direction: 'prev' | 'next') => {\n    setViewDate(prev => {\n      const newDate = new Date(prev);\n      newDate.setFullYear(prev.getFullYear() + (direction === 'next' ? 1 : -1));\n      return newDate;\n    });\n  };\n\n  const goToToday = () => {\n    const today = new Date();\n    setViewDate(today);\n    if (isValidDate(today, minDate, maxDate)) {\n      handleDateSelect(today);\n    }\n  };\n\n  const renderCalendar = () => {\n    const year = viewDate.getFullYear();\n    const month = viewDate.getMonth();\n    const firstDayOfMonth = new Date(year, month, 1);\n    const lastDayOfMonth = new Date(year, month + 1, 0);\n    const firstDayOfWeek = firstDayOfMonth.getDay();\n    const daysInMonth = lastDayOfMonth.getDate();\n    \n    const days: (Date | null)[] = [];\n    \n    // Add empty cells for days before the first day of the month\n    for (let i = 0; i < firstDayOfWeek; i++) {\n      days.push(null);\n    }\n    \n    // Add all days of the month\n    for (let day = 1; day <= daysInMonth; day++) {\n      days.push(new Date(year, month, day));\n    }\n    \n    return (\n      <div className=\"p-3 space-y-4\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-2\">\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => navigateYear('prev')}\n              className=\"p-1 h-8 w-8\"\n            >\n              <ChevronLeft className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => navigateMonth('prev')}\n              className=\"p-1 h-8 w-8\"\n            >\n              <ChevronLeft className=\"w-3 h-3\" />\n            </Button>\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <span className=\"font-semibold text-sm\">\n              {MONTHS[month]} {year}\n            </span>\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => navigateMonth('next')}\n              className=\"p-1 h-8 w-8\"\n            >\n              <ChevronRight className=\"w-3 h-3\" />\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => navigateYear('next')}\n              className=\"p-1 h-8 w-8\"\n            >\n              <ChevronRight className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n        \n        {/* Weekday headers */}\n        <div className=\"grid grid-cols-7 gap-1\">\n          {WEEKDAYS.map(day => (\n            <div\n              key={day}\n              className=\"h-8 flex items-center justify-center text-xs font-medium text-[var(--color-muted-foreground)]\"\n            >\n              {day}\n            </div>\n          ))}\n        </div>\n        \n        {/* Calendar days */}\n        <div className=\"grid grid-cols-7 gap-1\">\n          {days.map((date, index) => {\n            if (!date) {\n              return <div key={index} className=\"h-8\" />;\n            }\n            \n            const isSelected = value && isSameDay(date, value);\n            const isToday = isSameDay(date, new Date());\n            const isDisabled = !isValidDate(date, minDate, maxDate);\n            \n            return (\n              <Button\n                key={index}\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                disabled={isDisabled}\n                onClick={() => handleDateSelect(date)}\n                className={cn(\n                  \"h-8 w-8 p-0 font-normal transition-all duration-200\",\n                  {\n                    \"bg-[var(--color-primary)] text-white hover:bg-[var(--color-primary)]/90\": isSelected,\n                    \"ring-2 ring-[var(--color-primary)] ring-offset-1\": isToday && !isSelected,\n                    \"text-[var(--color-muted-foreground)] cursor-not-allowed\": isDisabled,\n                  }\n                )}\n              >\n                {date.getDate()}\n              </Button>\n            );\n          })}\n        </div>\n        \n        {/* Footer */}\n        <div className=\"flex items-center justify-between pt-2 border-t border-[var(--color-border)]\">\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={goToToday}\n            className=\"text-xs\"\n          >\n            Today\n          </Button>\n          \n          {value && (\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleClear}\n              className=\"text-xs text-[var(--color-muted-foreground)]\"\n            >\n              Clear\n            </Button>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className={cn(\"relative\", className)}>\n      {label && (\n        <label className=\"block text-sm font-medium mb-2\">\n          {label}\n          {required && <span className=\"text-[var(--color-error)] ml-1\">*</span>}\n        </label>\n      )}\n      \n      <div ref={triggerRef} className=\"relative\">\n        <Input\n          value={inputValue}\n          onChange={handleInputChange}\n          placeholder={placeholder}\n          disabled={disabled}\n          className={cn(\n            \"pr-10\",\n            error && \"border-[var(--color-error)] focus-visible:ring-[var(--color-error)]\"\n          )}\n          onFocus={() => setIsOpen(true)}\n        />\n        \n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          disabled={disabled}\n          onClick={() => setIsOpen(!isOpen)}\n          className=\"absolute right-1 top-1/2 transform -translate-y-1/2 p-2 h-8 w-8\"\n        >\n          <Calendar className=\"w-4 h-4\" />\n        </Button>\n      </div>\n      \n      {error && (\n        <p className=\"mt-1 text-xs text-[var(--color-error)]\">{error}</p>\n      )}\n      \n      {isOpen && (\n        <div\n          ref={dropdownRef}\n          className=\"absolute top-full left-0 mt-1 z-50 surface-overlay border border-[var(--color-border)] rounded-lg shadow-lg min-w-[280px]\"\n        >\n          {renderCalendar()}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Time picker component\nexport interface TimePickerProps {\n  value?: string; // HH:mm format\n  onChange?: (time: string) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  className?: string;\n  label?: string;\n  error?: string;\n  required?: boolean;\n  format24?: boolean;\n}\n\nexport function TimePicker({\n  value,\n  onChange,\n  placeholder = \"Select time...\",\n  disabled,\n  className,\n  label,\n  error,\n  required,\n  format24 = true\n}: TimePickerProps) {\n  const [isOpen, setIsOpen] = React.useState(false);\n  const [selectedHour, setSelectedHour] = React.useState(\n    value ? parseInt(value.split(':')[0]) : 12\n  );\n  const [selectedMinute, setSelectedMinute] = React.useState(\n    value ? parseInt(value.split(':')[1]) : 0\n  );\n  const [ampm, setAmpm] = React.useState<'AM' | 'PM'>(\n    value && !format24 ? (parseInt(value.split(':')[0]) >= 12 ? 'PM' : 'AM') : 'AM'\n  );\n  \n  const dropdownRef = React.useRef<HTMLDivElement>(null);\n  const triggerRef = React.useRef<HTMLDivElement>(null);\n\n  // Close on click outside\n  React.useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (\n        dropdownRef.current &&\n        !dropdownRef.current.contains(event.target as Node) &&\n        triggerRef.current &&\n        !triggerRef.current.contains(event.target as Node)\n      ) {\n        setIsOpen(false);\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleTimeSelect = () => {\n    let hour = selectedHour;\n    \n    if (!format24) {\n      if (ampm === 'PM' && hour !== 12) hour += 12;\n      if (ampm === 'AM' && hour === 12) hour = 0;\n    }\n    \n    const timeString = `${hour.toString().padStart(2, '0')}:${selectedMinute.toString().padStart(2, '0')}`;\n    onChange?.(timeString);\n    setIsOpen(false);\n  };\n\n  const formatDisplayTime = (time: string) => {\n    if (!format24) {\n      const [hours, minutes] = time.split(':');\n      const hour24 = parseInt(hours);\n      const hour12 = hour24 === 0 ? 12 : hour24 > 12 ? hour24 - 12 : hour24;\n      const period = hour24 >= 12 ? 'PM' : 'AM';\n      return `${hour12}:${minutes} ${period}`;\n    }\n    return time;\n  };\n\n  const hours = format24 \n    ? Array.from({ length: 24 }, (_, i) => i)\n    : Array.from({ length: 12 }, (_, i) => i + 1);\n  \n  const minutes = Array.from({ length: 60 }, (_, i) => i);\n\n  return (\n    <div className={cn(\"relative\", className)}>\n      {label && (\n        <label className=\"block text-sm font-medium mb-2\">\n          {label}\n          {required && <span className=\"text-[var(--color-error)] ml-1\">*</span>}\n        </label>\n      )}\n      \n      <div ref={triggerRef} className=\"relative\">\n        <Input\n          value={value ? formatDisplayTime(value) : ''}\n          placeholder={placeholder}\n          disabled={disabled}\n          readOnly\n          className={cn(\n            \"pr-10 cursor-pointer\",\n            error && \"border-[var(--color-error)] focus-visible:ring-[var(--color-error)]\"\n          )}\n          onClick={() => setIsOpen(!isOpen)}\n        />\n        \n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          disabled={disabled}\n          onClick={() => setIsOpen(!isOpen)}\n          className=\"absolute right-1 top-1/2 transform -translate-y-1/2 p-2 h-8 w-8\"\n        >\n          <CalendarDays className=\"w-4 h-4\" />\n        </Button>\n      </div>\n      \n      {error && (\n        <p className=\"mt-1 text-xs text-[var(--color-error)]\">{error}</p>\n      )}\n      \n      {isOpen && (\n        <div\n          ref={dropdownRef}\n          className=\"absolute top-full left-0 mt-1 z-50 surface-overlay border border-[var(--color-border)] rounded-lg shadow-lg p-4 min-w-[240px]\"\n        >\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center space-x-4\">\n              {/* Hours */}\n              <div className=\"flex-1\">\n                <label className=\"block text-xs font-medium mb-2\">Hour</label>\n                <div className=\"max-h-32 overflow-y-auto border border-[var(--color-border)] rounded\">\n                  {hours.map(hour => (\n                    <button\n                      key={hour}\n                      type=\"button\"\n                      onClick={() => setSelectedHour(hour)}\n                      className={cn(\n                        \"w-full p-2 text-sm text-left hover:bg-[var(--color-muted)] transition-colors\",\n                        selectedHour === hour && \"bg-[var(--color-primary)] text-white\"\n                      )}\n                    >\n                      {format24 ? hour.toString().padStart(2, '0') : hour}\n                    </button>\n                  ))}\n                </div>\n              </div>\n              \n              {/* Minutes */}\n              <div className=\"flex-1\">\n                <label className=\"block text-xs font-medium mb-2\">Minute</label>\n                <div className=\"max-h-32 overflow-y-auto border border-[var(--color-border)] rounded\">\n                  {minutes.filter(m => m % 5 === 0).map(minute => (\n                    <button\n                      key={minute}\n                      type=\"button\"\n                      onClick={() => setSelectedMinute(minute)}\n                      className={cn(\n                        \"w-full p-2 text-sm text-left hover:bg-[var(--color-muted)] transition-colors\",\n                        selectedMinute === minute && \"bg-[var(--color-primary)] text-white\"\n                      )}\n                    >\n                      {minute.toString().padStart(2, '0')}\n                    </button>\n                  ))}\n                </div>\n              </div>\n              \n              {/* AM/PM */}\n              {!format24 && (\n                <div>\n                  <label className=\"block text-xs font-medium mb-2\">Period</label>\n                  <div className=\"space-y-1\">\n                    {['AM', 'PM'].map(period => (\n                      <button\n                        key={period}\n                        type=\"button\"\n                        onClick={() => setAmpm(period as 'AM' | 'PM')}\n                        className={cn(\n                          \"w-full p-2 text-sm rounded border transition-colors\",\n                          ampm === period \n                            ? \"bg-[var(--color-primary)] text-white border-[var(--color-primary)]\" \n                            : \"border-[var(--color-border)] hover:bg-[var(--color-muted)]\"\n                        )}\n                      >\n                        {period}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n            \n            <div className=\"flex justify-end space-x-2 pt-2 border-t border-[var(--color-border)]\">\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsOpen(false)}\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"button\"\n                size=\"sm\"\n                onClick={handleTimeSelect}\n              >\n                Select\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Utility functions\nfunction formatDate(date: Date, format: 'short' | 'long' | 'numeric'): string {\n  switch (format) {\n    case 'long':\n      return date.toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      });\n    case 'numeric':\n      return date.toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit'\n      });\n    default:\n      return date.toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric'\n      });\n  }\n}\n\nfunction parseDate(dateString: string): Date | null {\n  if (!dateString.trim()) return null;\n  \n  const date = new Date(dateString);\n  return isNaN(date.getTime()) ? null : date;\n}\n\nfunction isValidDate(date: Date, minDate?: Date, maxDate?: Date): boolean {\n  if (minDate && date < minDate) return false;\n  if (maxDate && date > maxDate) return false;\n  return true;\n}\n\nfunction isSameDay(date1: Date, date2: Date): boolean {\n  return (\n    date1.getFullYear() === date2.getFullYear() &&\n    date1.getMonth() === date2.getMonth() &&\n    date1.getDate() === date2.getDate()\n  );\n}