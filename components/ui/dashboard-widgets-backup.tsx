import * as React from "react"
import { LucideIcon, MoreVertical, Maximize2, Minimize2, RefreshCw, Download, TrendingUp, TrendingDown } from "lucide-react"
import { cn } from "@/lib/utils"
import { Card, CardContent, CardHeader, CardTitle } from "./card"
import { Button } from "./button"
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger
} from "./dropdown-menu"
import { Badge } from "./badge"

interface WidgetProps {\n  title: string\n  subtitle?: string\n  icon?: LucideIcon\n  value?: string | number\n  change?: {\n    value: number\n    label?: string\n    period?: string\n  }\n  className?: string\n  loading?: boolean\n  error?: string\n  onRefresh?: () => void\n  onExport?: () => void\n  onExpand?: () => void\n  children?: React.ReactNode\n  size?: 'sm' | 'md' | 'lg' | 'xl'\n  variant?: 'default' | 'outlined' | 'elevated'\n  actions?: React.ReactNode\n}\n\nexport function DashboardWidget({\n  title,\n  subtitle,\n  icon: Icon,\n  value,\n  change,\n  className,\n  loading = false,\n  error,\n  onRefresh,\n  onExport,\n  onExpand,\n  children,\n  size = 'md',\n  variant = 'elevated',\n  actions\n}: WidgetProps) {\n  const sizeClasses = {\n    sm: 'p-4',\n    md: 'p-6',\n    lg: 'p-8',\n    xl: 'p-10'\n  }\n\n  const variantClasses = {\n    default: '',\n    outlined: 'border-2',\n    elevated: 'surface-elevated shadow-lg'\n  }\n\n  return (\n    <Card className={cn(\n      'transition-all duration-200 hover-lift group',\n      variantClasses[variant],\n      className\n    )}>\n      <CardHeader className={cn(\n        'flex flex-row items-start justify-between space-y-0',\n        sizeClasses[size]\n      )}>\n        <div className=\"space-y-1 flex-1\">\n          <div className=\"flex items-center gap-2\">\n            {Icon && (\n              <div className=\"p-2 rounded-lg bg-accent-primary/10 group-hover:bg-accent-primary/20 transition-colors\">\n                <Icon className=\"h-4 w-4 text-accent-primary\" />\n              </div>\n            )}\n            <CardTitle className=\"text-heading-medium font-semibold text-zinc-50\">\n              {title}\n            </CardTitle>\n          </div>\n          \n          {subtitle && (\n            <p className=\"text-body-small text-zinc-400\">{subtitle}</p>\n          )}\n          \n          {value && (\n            <div className=\"space-y-2\">\n              <p className=\"text-display-medium font-bold text-zinc-50\">\n                {typeof value === 'number' ? value.toLocaleString() : value}\n              </p>\n              \n              {change && (\n                <div className=\"flex items-center gap-2\">\n                  <div className={cn(\n                    \"flex items-center gap-1 text-sm font-medium\",\n                    change.value > 0 ? \"text-green-400\" : \n                    change.value < 0 ? \"text-red-400\" : \"text-zinc-400\"\n                  )}>\n                    {change.value > 0 && <TrendingUp className=\"h-3 w-3\" />}\n                    {change.value < 0 && <TrendingDown className=\"h-3 w-3\" />}\n                    {Math.abs(change.value).toFixed(1)}%\n                  </div>\n                  \n                  <span className=\"text-xs text-zinc-500\">\n                    {change.label} {change.period && `vs ${change.period}`}\n                  </span>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n        \n        {/* Widget Actions */}\n        <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n          {actions}\n          \n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                <MoreVertical className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              {onRefresh && (\n                <DropdownMenuItem onClick={onRefresh} className=\"gap-2\">\n                  <RefreshCw className=\"h-4 w-4\" />\n                  Refresh\n                </DropdownMenuItem>\n              )}\n              {onExpand && (\n                <DropdownMenuItem onClick={onExpand} className=\"gap-2\">\n                  <Maximize2 className=\"h-4 w-4\" />\n                  Expand\n                </DropdownMenuItem>\n              )}\n              {onExport && (\n                <>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem onClick={onExport} className=\"gap-2\">\n                    <Download className=\"h-4 w-4\" />\n                    Export Data\n                  </DropdownMenuItem>\n                </>\n              )}\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      </CardHeader>\n      \n      {(children || loading || error) && (\n        <CardContent className={cn('pt-0', sizeClasses[size])}>\n          {loading && (\n            <div className=\"flex items-center justify-center h-32\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-primary\" />\n            </div>\n          )}\n          \n          {error && (\n            <div className=\"flex items-center justify-center h-32\">\n              <div className=\"text-center\">\n                <p className=\"text-sm text-red-400 mb-2\">Error loading data</p>\n                <p className=\"text-xs text-zinc-500\">{error}</p>\n                {onRefresh && (\n                  <Button variant=\"outline\" size=\"sm\" onClick={onRefresh} className=\"mt-2\">\n                    Try Again\n                  </Button>\n                )}\n              </div>\n            </div>\n          )}\n          \n          {!loading && !error && children}\n        </CardContent>\n      )}\n    </Card>\n  )\n}\n\n// Pre-built widget variants\ninterface StatWidgetProps {\n  title: string\n  value: string | number\n  change?: number\n  changeLabel?: string\n  icon: LucideIcon\n  className?: string\n  color?: string\n}\n\nexport function StatWidget({\n  title,\n  value,\n  change,\n  changeLabel = \"vs last period\",\n  icon: Icon,\n  className,\n  color = \"var(--color-accent-primary)\"\n}: StatWidgetProps) {\n  return (\n    <DashboardWidget\n      title={title}\n      value={value}\n      change={change ? {\n        value: change,\n        label: changeLabel\n      } : undefined}\n      icon={Icon}\n      className={className}\n      size=\"sm\"\n    />\n  )\n}\n\ninterface ChartWidgetProps {\n  title: string\n  subtitle?: string\n  chart: React.ReactNode\n  className?: string\n  onRefresh?: () => void\n  onExport?: () => void\n  loading?: boolean\n  error?: string\n}\n\nexport function ChartWidget({\n  title,\n  subtitle,\n  chart,\n  className,\n  onRefresh,\n  onExport,\n  loading,\n  error\n}: ChartWidgetProps) {\n  return (\n    <DashboardWidget\n      title={title}\n      subtitle={subtitle}\n      className={className}\n      onRefresh={onRefresh}\n      onExport={onExport}\n      loading={loading}\n      error={error}\n      size=\"lg\"\n    >\n      {chart}\n    </DashboardWidget>\n  )\n}\n\ninterface ListWidgetProps<T> {\n  title: string\n  subtitle?: string\n  items: T[]\n  renderItem: (item: T, index: number) => React.ReactNode\n  className?: string\n  emptyMessage?: string\n  showAll?: boolean\n  onSeeMore?: () => void\n  loading?: boolean\n}\n\nexport function ListWidget<T>({\n  title,\n  subtitle,\n  items,\n  renderItem,\n  className,\n  emptyMessage = \"No items to display\",\n  showAll = false,\n  onSeeMore,\n  loading = false\n}: ListWidgetProps<T>) {\n  const displayItems = showAll ? items : items.slice(0, 5)\n  const hasMore = items.length > 5 && !showAll\n\n  return (\n    <DashboardWidget\n      title={title}\n      subtitle={subtitle}\n      className={className}\n      loading={loading}\n      size=\"md\"\n    >\n      {items.length === 0 ? (\n        <div className=\"text-center py-8\">\n          <p className=\"text-sm text-zinc-400\">{emptyMessage}</p>\n        </div>\n      ) : (\n        <div className=\"space-y-3\">\n          {displayItems.map((item, index) => (\n            <div key={index} className=\"border-l-2 border-transparent hover:border-accent-primary transition-colors\">\n              <div className=\"pl-3\">\n                {renderItem(item, index)}\n              </div>\n            </div>\n          ))}\n          \n          {hasMore && onSeeMore && (\n            <Button variant=\"ghost\" size=\"sm\" onClick={onSeeMore} className=\"w-full mt-4\">\n              Show {items.length - 5} more items\n            </Button>\n          )}\n        </div>\n      )}\n    </DashboardWidget>\n  )\n}\n\n// Widget Grid Layout\ninterface DashboardGridProps {\n  children: React.ReactNode\n  columns?: 1 | 2 | 3 | 4 | 6\n  gap?: 2 | 3 | 4 | 6 | 8\n  className?: string\n}\n\nexport function DashboardGrid({\n  children,\n  columns = 3,\n  gap = 6,\n  className\n}: DashboardGridProps) {\n  const gridClasses = {\n    1: 'grid-cols-1',\n    2: 'md:grid-cols-2',\n    3: 'md:grid-cols-2 lg:grid-cols-3',\n    4: 'md:grid-cols-2 lg:grid-cols-4',\n    6: 'md:grid-cols-3 lg:grid-cols-6'\n  }\n\n  const gapClasses = {\n    2: 'gap-2',\n    3: 'gap-3', \n    4: 'gap-4',\n    6: 'gap-6',\n    8: 'gap-8'\n  }\n\n  return (\n    <div className={cn(\n      'grid',\n      gridClasses[columns],\n      gapClasses[gap],\n      className\n    )}>\n      {children}\n    </div>\n  )\n}\n